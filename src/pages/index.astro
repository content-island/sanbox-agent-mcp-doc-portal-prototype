---
import Layout from '../layouts/Layout.astro';
import { getNavigationStructure } from '../lib/content-island';
import type { NavigationFolder } from '../lib/content-island';

let navigationData: { folders: NavigationFolder[] } = { folders: [] };
let error = '';

try {
  navigationData = await getNavigationStructure();
} catch (err) {
  console.error('Failed to load navigation:', err);
  error = 'Failed to load documentation data';
}
---

<Layout title="Welcome to Documentation">
  <div class="content-header">
    <h1 class="content-title">Welcome to Documentation</h1>
    <p class="content-description">
      Browse through our comprehensive documentation using the navigation sidebar.
    </p>
  </div>

  {error ? (
    <div class="error-message" role="alert">
      <h2>Error Loading Documentation</h2>
      <p>{error}</p>
      <p>Please check your Content Island configuration and try again.</p>
    </div>
  ) : navigationData.folders.length === 0 ? (
    <div class="loading">
      <p>Loading documentation...</p>
    </div>
  ) : (
    <div class="markdown-content">
      <h2>Available Documentation Sections</h2>
      <p>Choose a section from the sidebar to get started:</p>
      
      <div style="display: grid; gap: 1.5rem; margin-top: 2rem;">
        {navigationData.folders.map((folder) => (
          <div style="border: 1px solid #e1e4e8; border-radius: 8px; padding: 1.5rem; background-color: #f8f9fa;">
            <h3 style="margin-top: 0; margin-bottom: 1rem; color: #1f2328;">
              {folder.title}
            </h3>
            {folder.items.length > 0 ? (
              <ul style="margin-bottom: 0;">
                {folder.items.map((item) => (
                  <li>
                    <a 
                      href={`/${folder.slug}/${item.slug}`}
                      style="color: #0969da; text-decoration: none;"
                    >
                      {item.title}
                    </a>
                    {item.description && (
                      <span style="color: #656d76; margin-left: 0.5rem;">
                        - {item.description}
                      </span>
                    )}
                  </li>
                ))}
              </ul>
            ) : (
              <p style="color: #656d76; margin-bottom: 0;">No items in this section yet.</p>
            )}
          </div>
        ))}
      </div>
    </div>
  )}
</Layout>
